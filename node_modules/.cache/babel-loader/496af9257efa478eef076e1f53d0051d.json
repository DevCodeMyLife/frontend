{"ast":null,"code":"import _classCallCheck from\"/Users/andrejsmelev-sampanov/Documents/org_devcodemylife/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/andrejsmelev-sampanov/Documents/org_devcodemylife/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/andrejsmelev-sampanov/Documents/org_devcodemylife/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/andrejsmelev-sampanov/Documents/org_devcodemylife/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{mount,route}from'navi';import{Link,Router,View}from'react-navi';import React,{Suspense}from'react';import ReactDOM from'react-dom';import'./style/index.css';import HelmetProvider from'react-navi-helmet-async';import Head from'./components/Header';import Feed from\"./components/Feed\";import FeedOnePage from\"./components/FeedOnePage\";import About from\"./components/About\";import{BrowserRouter,Route,Switch}from\"react-router-dom\";import Centrifuge from\"centrifuge\";import Main from\"./components/Main\";import MainUser from\"./components/MainUser\";import Messages from\"./components/Messages\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CONFIG={url:document.location.host===\"localhost\"?\"ws://\".concat(document.location.host,\"/cent/connection/websocket\"):\"wss://\".concat(document.location.host,\"/cent/connection/websocket\")};var auth=false;var cent=null;var user=null;var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.routes=mount({'/':route({title:'DevCodeMyLife - Добро пожаловать',head:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"meta\",{name:\"description\",content:\"\\u0421\\u043E\\u0446\\u0438\\u0430\\u043B\\u044C\\u043D\\u0430\\u044F \\u0441\\u0435\\u0442\\u044C \\u0434\\u043B\\u044F \\u0440\\u0430\\u0437\\u0440\\u0430\\u0431\\u043E\\u0442\\u0447\\u0438\\u043A\\u043E\\u0432\"}),/*#__PURE__*/_jsx(\"script\",{children:\"console.log('[ app start ]')\"})]}),view:/*#__PURE__*/_jsx(Main,{})}),'/messages':route({title:'Мессенджер',head:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"meta\",{name:\"description\",content:\"\\u041C\\u0435\\u0441\\u0441\\u0435\\u043D\\u0434\\u0436\\u0435\\u0440\"}),/*#__PURE__*/_jsx(\"script\",{children:\"console.log('[ app start ]')\"})]}),view:/*#__PURE__*/_jsx(Messages,{auth:auth,cent:cent,user:user})}),'/user':route({title:'DevCodeMyLife',head:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"meta\",{name:\"description\",content:\"\"}),/*#__PURE__*/_jsx(\"script\",{children:\"console.log('[ app start ]')\"})]}),view:/*#__PURE__*/_jsx(MainUser,{})}),'/feeds':route({title:'Новости',head:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"meta\",{name:\"description\",content:\"\\u041D\\u043E\\u0432\\u043E\\u0441\\u0442\\u0438, \\u0443 \\u043D\\u0430\\u0441 \\u0435\\u0441\\u0442\\u044C \\u0432\\u0441\\u0435, \\u0447\\u0435\\u0433\\u043E \\u043D\\u0435\\u0442 \\u043D\\u0430\\u043F\\u0438\\u0448\\u0438 \\u0441\\u0430\\u043C.\"}),/*#__PURE__*/_jsx(\"script\",{children:\"console.log('[ app start ]')\"})]}),view:/*#__PURE__*/_jsx(Feed,{})}),'/post':route({title:'DevCodeMyLife',head:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"meta\",{name:\"description\",content:\"\"}),/*#__PURE__*/_jsx(\"script\",{children:\"console.log('[ app start ]')\"})]}),view:/*#__PURE__*/_jsx(FeedOnePage,{})}),'/about':route({title:'DevCodeMyLife',head:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"meta\",{name:\"description\",content:\"\"}),/*#__PURE__*/_jsx(\"script\",{children:\"console.log('[ app start ]')\"})]}),view:/*#__PURE__*/_jsx(About,{})})});_this.state={auth:false,load:false,data:[],feed:[],token:null,notification_count:0,notification:[],messagesCount:0,headComponent:null};return _this;}_createClass(App,[{key:\"sendLogs\",value:function sendLogs(message){fetch(\"/logs/gelf\",{method:\"POST\",body:JSON.stringify({\"version\":\"1.1\",\"host\":document.location.host,\"short_message\":message,\"level\":5,\"_some_info\":\"foo\"}),headers:{\"Content-Type\":\"application/json\"}}).then(function(_){});}},{key:\"checkCookie\",value:function checkCookie(cname){var ca=document.cookie.split(';');var array={};for(var i=0;i<ca.length;i++){array[ca[i].split('=')[0].trim()]=ca[i].split('=')[1];}return Object.keys(array).includes(cname);}},{key:\"delete_cookie\",value:function delete_cookie(name){document.cookie=name+'=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.setState({headComponent:/*#__PURE__*/_jsx(Head,{auth:false,user:this.state.data[0],load:false})});var check=true;if(check){fetch(\"/api/authentication\",{method:\"POST\",body:JSON.stringify({\"finger\":window.localStorage.getItem(\"finger\")})}).then(function(response){return response.json();}).then(function(res){if(res.status.code===0){auth=true;user=res.data;_this2.setState({auth:true,data:res.data,feed:res.feed,notification_count:res.notification_count,notification:res.notification,token:res.token,messagesCount:res.count_message});}else{_this2.sendLogs(res.status.message);_this2.delete_cookie(\"access_token\");}_this2.setState({load:true,headComponent:null});_this2.setState({headComponent:/*#__PURE__*/_jsx(Head,{auth:true,user:res.data[0],load:true})});}).catch(function(error){_this2.setState({auth:false,load:true,token:\"asd\",headComponent:null});_this2.setState({headComponent:/*#__PURE__*/_jsx(Head,{auth:false,load:true})});});}else{this.setState({auth:false,load:true,token:\"asd\",headComponent:null});this.setState({headComponent:/*#__PURE__*/_jsx(Head,{auth:false,load:true})});}this.centrifuge=new Centrifuge(CONFIG.url);this.centrifuge.setToken(\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE2MjYwMzI0MzEsImV4cCI6MTc4Mzc5ODgzMSwiYXVkIjoid3d3LmV4YW1wbGUuY29tIiwic3ViIjoianJvY2tldEBleGFtcGxlLmNvbSIsIkdpdmVuTmFtZSI6IkpvaG5ueSIsIlN1cm5hbWUiOiJSb2NrZXQiLCJFbWFpbCI6Impyb2NrZXRAZXhhbXBsZS5jb20iLCJSb2xlIjpbIk1hbmFnZXIiLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.meN08YC99TeOJZWLbMKCwxhtOA_s3RaZ1QH-YARC6CM\");this.centrifuge.on('connect',function(){console.log(\"[ centrifuge connected ]\");});this.centrifuge.on('disconnect',function(){console.log(\"[ centrifuge disconnected ]\");});this.centrifuge.connect();this.centrifuge.subscribe(\"public\",function(message){console.log(message);});if(!window.Notification||!Notification.requestPermission){console.log('...');}else{Notification.requestPermission(function(permission){// console.log('Результат запроса прав:', permission);\n});}cent=this.centrifuge;}},{key:\"render\",value:function render(){var _this3=this;if(this.state.load){if(this.state.auth){return/*#__PURE__*/_jsx(HelmetProvider,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper\",children:[this.state.headComponent,/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsx(Switch,{children:/*#__PURE__*/_jsx(Route,{path:\"/\",render:function render(_ref){var history=_ref.history,match=_ref.match;return/*#__PURE__*/_jsx(Router,{routes:_this3.routes,history:history,basename:match.url,children:/*#__PURE__*/_jsx(Suspense,{fallback:null,children:/*#__PURE__*/_jsx(View,{})})});}})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"footer\",children:[\"\\xA9 \",new Date().getFullYear(),\" DevCodeMyLife\"]})]})});}else{return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Head,{auth:false,load:true}),/*#__PURE__*/_jsx(Main,{})]});}}else{return/*#__PURE__*/_jsx(\"div\",{style:{position:\"fixed\",width:\"100%\",height:\"100%\",display:\"flex\",justifyContent:\"center\",alignItems:\"center\"},children:/*#__PURE__*/_jsx(\"div\",{className:\"loader\"})});}}}]);return App;}(React.Component);ReactDOM.render(/*#__PURE__*/React.createElement(App,null),document.getElementById('root'));","map":{"version":3,"sources":["/Users/andrejsmelev-sampanov/Documents/org_devcodemylife/frontend/src/index.js"],"names":["mount","route","Link","Router","View","React","Suspense","ReactDOM","HelmetProvider","Head","Feed","FeedOnePage","About","BrowserRouter","Route","Switch","Centrifuge","Main","MainUser","Messages","CONFIG","url","document","location","host","auth","cent","user","App","props","routes","title","head","view","state","load","data","feed","token","notification_count","notification","messagesCount","headComponent","message","fetch","method","body","JSON","stringify","headers","then","_","cname","ca","cookie","split","array","i","length","trim","Object","keys","includes","name","setState","check","window","localStorage","getItem","response","json","res","status","code","count_message","sendLogs","delete_cookie","catch","error","centrifuge","setToken","on","console","log","connect","subscribe","Notification","requestPermission","permission","history","match","Date","getFullYear","position","width","height","display","justifyContent","alignItems","Component","render","createElement","getElementById"],"mappings":"gtBAAA,OAASA,KAAT,CAAgBC,KAAhB,KAA6B,MAA7B,CACA,OAAQC,IAAR,CAAcC,MAAd,CAAsBC,IAAtB,KAAiC,YAAjC,CACA,MAAOC,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,MAAOC,CAAAA,QAAP,KAAqB,WAArB,CACA,MAAO,mBAAP,CACA,MAAOC,CAAAA,cAAP,KAA2B,yBAA3B,CACA,MAAOC,CAAAA,IAAP,KAAiB,qBAAjB,CACA,MAAOC,CAAAA,IAAP,KAAiB,mBAAjB,CACA,MAAOC,CAAAA,WAAP,KAAwB,0BAAxB,CACA,MAAOC,CAAAA,KAAP,KAAkB,oBAAlB,CACA,OAAQC,aAAR,CAAuBC,KAAvB,CAA8BC,MAA9B,KAA2C,kBAA3C,CACA,MAAOC,CAAAA,UAAP,KAAuB,YAAvB,CACA,MAAOC,CAAAA,IAAP,KAAiB,mBAAjB,CACA,MAAOC,CAAAA,QAAP,KAAqB,uBAArB,CACA,MAAOC,CAAAA,QAAP,KAAqB,uBAArB,C,6IAEA,GAAMC,CAAAA,MAAM,CAAG,CACXC,GAAG,CAAEC,QAAQ,CAACC,QAAT,CAAkBC,IAAlB,GAA2B,WAA3B,gBAAiDF,QAAQ,CAACC,QAAT,CAAkBC,IAAnE,+CAA+GF,QAAQ,CAACC,QAAT,CAAkBC,IAAjI,8BADM,CAAf,CAIA,GAAIC,CAAAA,IAAI,CAAG,KAAX,CACA,GAAIC,CAAAA,IAAI,CAAG,IAAX,CACA,GAAIC,CAAAA,IAAI,CAAG,IAAX,C,GAEMC,CAAAA,G,sGAEF,aAAYC,KAAZ,CAAmB,qCACf,uBAAMA,KAAN,EADe,MA2JnBC,MA3JmB,CA2JV9B,KAAK,CAAC,CACX,IAAKC,KAAK,CAAC,CACP8B,KAAK,CAAE,kCADA,CAEPC,IAAI,cAAE,wCACF,aAAM,IAAI,CAAC,aAAX,CAAyB,OAAO,CAAC,yLAAjC,EADE,cAEF,wDAFE,GAFC,CAQPC,IAAI,cAAE,KAAC,IAAD,IARC,CAAD,CADC,CAWX,YAAahC,KAAK,CAAC,CACf8B,KAAK,CAAE,YADQ,CAEfC,IAAI,cAAE,wCACF,aAAM,IAAI,CAAC,aAAX,CAAyB,OAAO,CAAC,8DAAjC,EADE,cAEF,wDAFE,GAFS,CAQfC,IAAI,cAAE,KAAC,QAAD,EAAU,IAAI,CAAER,IAAhB,CAAsB,IAAI,CAAEC,IAA5B,CAAkC,IAAI,CAAEC,IAAxC,EARS,CAAD,CAXP,CAqBX,QAAS1B,KAAK,CAAC,CACX8B,KAAK,CAAE,eADI,CAEXC,IAAI,cAAE,wCACF,aAAM,IAAI,CAAC,aAAX,CAAyB,OAAO,CAAC,EAAjC,EADE,cAEF,wDAFE,GAFK,CAQXC,IAAI,cAAE,KAAC,QAAD,IARK,CAAD,CArBH,CA+BX,SAAUhC,KAAK,CAAC,CACZ8B,KAAK,CAAE,SADK,CAEZC,IAAI,cAAE,wCACF,aAAM,IAAI,CAAC,aAAX,CAAyB,OAAO,CAAC,yNAAjC,EADE,cAEF,wDAFE,GAFM,CAQZC,IAAI,cAAE,KAAC,IAAD,IARM,CAAD,CA/BJ,CAyCX,QAAShC,KAAK,CAAC,CACX8B,KAAK,CAAE,eADI,CAEXC,IAAI,cAAE,wCACF,aAAM,IAAI,CAAC,aAAX,CAAyB,OAAO,CAAC,EAAjC,EADE,cAEF,wDAFE,GAFK,CAQXC,IAAI,cAAE,KAAC,WAAD,IARK,CAAD,CAzCH,CAmDX,SAAUhC,KAAK,CAAC,CACZ8B,KAAK,CAAE,eADK,CAEZC,IAAI,cAAE,wCACF,aAAM,IAAI,CAAC,aAAX,CAAyB,OAAO,CAAC,EAAjC,EADE,cAEF,wDAFE,GAFM,CAQZC,IAAI,cAAE,KAAC,KAAD,IARM,CAAD,CAnDJ,CAAD,CA3JK,CAEf,MAAKC,KAAL,CAAa,CACTT,IAAI,CAAE,KADG,CAETU,IAAI,CAAE,KAFG,CAGTC,IAAI,CAAE,EAHG,CAITC,IAAI,CAAE,EAJG,CAKTC,KAAK,CAAE,IALE,CAMTC,kBAAkB,CAAE,CANX,CAOTC,YAAY,CAAE,EAPL,CAQTC,aAAa,CAAE,CARN,CASTC,aAAa,CAAE,IATN,CAAb,CAFe,aAclB,C,wCAED,kBAASC,OAAT,CAAkB,CACdC,KAAK,CAAC,YAAD,CAAe,CAChBC,MAAM,CAAE,MADQ,CAEhBC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CACjB,UAAW,KADM,CAEjB,OAAQ1B,QAAQ,CAACC,QAAT,CAAkBC,IAFT,CAGjB,gBAAiBmB,OAHA,CAIjB,QAAS,CAJQ,CAIL,aAAc,KAJT,CAAf,CAFU,CAQhBM,OAAO,CAAE,CACL,eAAgB,kBADX,CARO,CAAf,CAAL,CAWGC,IAXH,CAWQ,SAAAC,CAAC,CAAI,CAAE,CAXf,EAYH,C,2BAED,qBAAYC,KAAZ,CAAmB,CACf,GAAIC,CAAAA,EAAE,CAAG/B,QAAQ,CAACgC,MAAT,CAAgBC,KAAhB,CAAsB,GAAtB,CAAT,CACA,GAAIC,CAAAA,KAAK,CAAG,EAAZ,CAEA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGJ,EAAE,CAACK,MAAvB,CAA+BD,CAAC,EAAhC,CAAoC,CAChCD,KAAK,CAACH,EAAE,CAACI,CAAD,CAAF,CAAMF,KAAN,CAAY,GAAZ,EAAiB,CAAjB,EAAoBI,IAApB,EAAD,CAAL,CAAoCN,EAAE,CAACI,CAAD,CAAF,CAAMF,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAApC,CACH,CAED,MAAOK,CAAAA,MAAM,CAACC,IAAP,CAAYL,KAAZ,EAAmBM,QAAnB,CAA4BV,KAA5B,CAAP,CACH,C,6BAED,uBAAcW,IAAd,CAAoB,CAChBzC,QAAQ,CAACgC,MAAT,CAAkBS,IAAI,CAAE,mDAAxB,CACH,C,iCAGD,4BAAoB,iBAChB,KAAKC,QAAL,CAAc,CACVtB,aAAa,cAAE,KAAC,IAAD,EACX,IAAI,CAAE,KADK,CAEX,IAAI,CAAE,KAAKR,KAAL,CAAWE,IAAX,CAAgB,CAAhB,CAFK,CAGX,IAAI,CAAE,KAHK,EADL,CAAd,EAQA,GAAI6B,CAAAA,KAAK,CAAG,IAAZ,CACA,GAAIA,KAAJ,CAAU,CACNrB,KAAK,CAAC,qBAAD,CAAwB,CACzBC,MAAM,CAAE,MADiB,CAEzBC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CACjB,SAAUkB,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,QAA5B,CADO,CAAf,CAFmB,CAAxB,CAAL,CAMKlB,IANL,CAMU,SAAAmB,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EANlB,EAOKpB,IAPL,CAOU,SAAAqB,GAAG,CAAI,CACT,GAAIA,GAAG,CAACC,MAAJ,CAAWC,IAAX,GAAoB,CAAxB,CAA0B,CACtBhD,IAAI,CAAG,IAAP,CACAE,IAAI,CAAG4C,GAAG,CAACnC,IAAX,CACA,MAAI,CAAC4B,QAAL,CAAc,CACVvC,IAAI,CAAE,IADI,CAEVW,IAAI,CAAEmC,GAAG,CAACnC,IAFA,CAGVC,IAAI,CAAEkC,GAAG,CAAClC,IAHA,CAIVE,kBAAkB,CAAEgC,GAAG,CAAChC,kBAJd,CAKVC,YAAY,CAAE+B,GAAG,CAAC/B,YALR,CAMVF,KAAK,CAAEiC,GAAG,CAACjC,KAND,CAOVG,aAAa,CAAE8B,GAAG,CAACG,aAPT,CAAd,EASH,CAZD,IAYK,CACD,MAAI,CAACC,QAAL,CAAcJ,GAAG,CAACC,MAAJ,CAAW7B,OAAzB,EACA,MAAI,CAACiC,aAAL,CAAmB,cAAnB,EACH,CACD,MAAI,CAACZ,QAAL,CAAc,CACV7B,IAAI,CAAE,IADI,CAEVO,aAAa,CAAE,IAFL,CAAd,EAKA,MAAI,CAACsB,QAAL,CAAc,CACVtB,aAAa,cAAE,KAAC,IAAD,EACX,IAAI,CAAE,IADK,CAEX,IAAI,CAAE6B,GAAG,CAACnC,IAAJ,CAAS,CAAT,CAFK,CAGX,IAAI,CAAE,IAHK,EADL,CAAd,EASH,CAtCL,EAuCKyC,KAvCL,CAuCW,SAAAC,KAAK,CAAI,CACZ,MAAI,CAACd,QAAL,CAAc,CACVvC,IAAI,CAAE,KADI,CAEVU,IAAI,CAAE,IAFI,CAGVG,KAAK,CAAE,KAHG,CAIVI,aAAa,CAAE,IAJL,CAAd,EAOA,MAAI,CAACsB,QAAL,CAAc,CACVtB,aAAa,cAAE,KAAC,IAAD,EACX,IAAI,CAAE,KADK,CAEX,IAAI,CAAE,IAFK,EADL,CAAd,EAMH,CArDL,EAsDH,CAvDD,IAuDK,CACD,KAAKsB,QAAL,CAAc,CACVvC,IAAI,CAAE,KADI,CAEVU,IAAI,CAAE,IAFI,CAGVG,KAAK,CAAE,KAHG,CAIVI,aAAa,CAAE,IAJL,CAAd,EAOA,KAAKsB,QAAL,CAAc,CACVtB,aAAa,cAAE,KAAC,IAAD,EACX,IAAI,CAAE,KADK,CAEX,IAAI,CAAE,IAFK,EADL,CAAd,EAMH,CAED,KAAKqC,UAAL,CAAkB,GAAI/D,CAAAA,UAAJ,CAAeI,MAAM,CAACC,GAAtB,CAAlB,CACA,KAAK0D,UAAL,CAAgBC,QAAhB,CAAyB,kYAAzB,EAEA,KAAKD,UAAL,CAAgBE,EAAhB,CAAmB,SAAnB,CAA8B,UAAW,CACrCC,OAAO,CAACC,GAAR,CAAY,0BAAZ,EACH,CAFD,EAGA,KAAKJ,UAAL,CAAgBE,EAAhB,CAAmB,YAAnB,CAAiC,UAAU,CACvCC,OAAO,CAACC,GAAR,CAAY,6BAAZ,EACH,CAFD,EAGA,KAAKJ,UAAL,CAAgBK,OAAhB,GAGA,KAAKL,UAAL,CAAgBM,SAAhB,CAA0B,QAA1B,CAAoC,SAAS1C,OAAT,CAAkB,CAClDuC,OAAO,CAACC,GAAR,CAAYxC,OAAZ,EACH,CAFD,EAIA,GAAI,CAACuB,MAAM,CAACoB,YAAR,EAAwB,CAACA,YAAY,CAACC,iBAA1C,CAA4D,CACxDL,OAAO,CAACC,GAAR,CAAY,KAAZ,EACH,CAFD,IAEK,CACDG,YAAY,CAACC,iBAAb,CAA+B,SAASC,UAAT,CAAoB,CAC/C;AACH,CAFD,EAGH,CAED9D,IAAI,CAAG,KAAKqD,UAAZ,CACH,C,sBAiED,iBAAQ,iBACJ,GAAI,KAAK7C,KAAL,CAAWC,IAAf,CAAoB,CAChB,GAAI,KAAKD,KAAL,CAAWT,IAAf,CAAoB,CAChB,mBACI,KAAC,cAAD,wBACI,aAAK,SAAS,CAAC,SAAf,WAEQ,KAAKS,KAAL,CAAWQ,aAFnB,cAKI,KAAC,aAAD,wBACI,KAAC,MAAD,wBACI,KAAC,KAAD,EAAO,IAAI,CAAC,GAAZ,CAAgB,MAAM,CAAE,yBAAE+C,CAAAA,OAAF,MAAEA,OAAF,CAAWC,KAAX,MAAWA,KAAX,oBACpB,KAAC,MAAD,EACI,MAAM,CAAE,MAAI,CAAC5D,MADjB,CAEI,OAAO,CAAE2D,OAFb,CAGI,QAAQ,CAAEC,KAAK,CAACrE,GAHpB,uBAKI,KAAC,QAAD,EAAU,QAAQ,CAAE,IAApB,uBACI,KAAC,IAAD,IADJ,EALJ,EADoB,EAAxB,EADJ,EADJ,EALJ,cAoBI,aAAK,SAAS,CAAC,QAAf,mBACO,GAAIsE,CAAAA,IAAJ,GAAWC,WAAX,EADP,oBApBJ,GADJ,EADJ,CA4BH,CA7BD,IA6BK,CACD,mBACI,oCACI,KAAC,IAAD,EAAM,IAAI,CAAE,KAAZ,CAAmB,IAAI,CAAE,IAAzB,EADJ,cAEI,KAAC,IAAD,IAFJ,GADJ,CAMH,CACJ,CAtCD,IAsCK,CACD,mBACI,YAAK,KAAK,CAAE,CACRC,QAAQ,CAAE,OADF,CAERC,KAAK,CAAE,MAFC,CAGRC,MAAM,CAAE,MAHA,CAIRC,OAAO,CAAE,MAJD,CAKRC,cAAc,CAAE,QALR,CAMRC,UAAU,CAAE,QANJ,CAAZ,uBAQI,YAAK,SAAS,CAAC,QAAf,EARJ,EADJ,CAYH,CAEJ,C,iBAlRa7F,KAAK,CAAC8F,S,EAqRxB5F,QAAQ,CAAC6F,MAAT,cACI/F,KAAK,CAACgG,aAAN,CAAoBzE,GAApB,CAAyB,IAAzB,CADJ,CAEIN,QAAQ,CAACgF,cAAT,CAAwB,MAAxB,CAFJ","sourcesContent":["import { mount, route } from 'navi'\nimport {Link, Router, View} from 'react-navi'\nimport React, { Suspense } from 'react'\nimport ReactDOM from 'react-dom'\nimport './style/index.css'\nimport HelmetProvider from 'react-navi-helmet-async'\nimport Head from './components/Header'\nimport Feed from \"./components/Feed\";\nimport FeedOnePage from \"./components/FeedOnePage\";\nimport About from \"./components/About\";\nimport {BrowserRouter, Route, Switch} from \"react-router-dom\";\nimport Centrifuge from \"centrifuge\";\nimport Main from \"./components/Main\";\nimport MainUser from \"./components/MainUser\";\nimport Messages from \"./components/Messages\";\n\nconst CONFIG = {\n    url: document.location.host === \"localhost\" ? `ws://${document.location.host}/cent/connection/websocket` : `wss://${document.location.host}/cent/connection/websocket`\n};\n\nlet auth = false\nlet cent = null\nlet user = null\n\nclass App extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            auth: false,\n            load: false,\n            data: [],\n            feed: [],\n            token: null,\n            notification_count: 0,\n            notification: [],\n            messagesCount: 0,\n            headComponent: null\n        }\n\n    }\n\n    sendLogs(message) {\n        fetch(\"/logs/gelf\", {\n            method: \"POST\",\n            body: JSON.stringify({\n                \"version\": \"1.1\",\n                \"host\": document.location.host,\n                \"short_message\": message,\n                \"level\": 5, \"_some_info\": \"foo\"\n            }),\n            headers: {\n                \"Content-Type\": \"application/json\"\n            }\n        }).then(_ => {})\n    }\n\n    checkCookie(cname) {\n        let ca = document.cookie.split(';');\n        let array = {};\n\n        for (let i = 0; i < ca.length; i++) {\n            array[ca[i].split('=')[0].trim()] = ca[i].split('=')[1]\n        }\n\n        return Object.keys(array).includes(cname);\n    }\n\n    delete_cookie(name) {\n        document.cookie = name +'=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n    }\n\n\n    componentDidMount() {\n        this.setState({\n            headComponent: <Head\n                auth={false}\n                user={this.state.data[0]}\n                load={false}\n            />\n        })\n\n        let check = true\n        if (check){\n            fetch(\"/api/authentication\", {\n                method: \"POST\",\n                body: JSON.stringify({\n                    \"finger\": window.localStorage.getItem(\"finger\")\n                })\n            })\n                .then(response => response.json())\n                .then(res => {\n                    if (res.status.code === 0){\n                        auth = true\n                        user = res.data\n                        this.setState({\n                            auth: true,\n                            data: res.data,\n                            feed: res.feed,\n                            notification_count: res.notification_count,\n                            notification: res.notification,\n                            token: res.token,\n                            messagesCount: res.count_message\n                        });\n                    }else{\n                        this.sendLogs(res.status.message)\n                        this.delete_cookie(\"access_token\")\n                    }\n                    this.setState({\n                        load: true,\n                        headComponent: null\n                    });\n\n                    this.setState({\n                        headComponent: <Head\n                            auth={true}\n                            user={res.data[0]}\n                            load={true}\n                        />\n                    })\n\n\n                })\n                .catch(error => {\n                    this.setState({\n                        auth: false,\n                        load: true,\n                        token: \"asd\",\n                        headComponent: null\n                    });\n\n                    this.setState({\n                        headComponent: <Head\n                            auth={false}\n                            load={true}\n                        />\n                    })\n                });\n        }else{\n            this.setState({\n                auth: false,\n                load: true,\n                token: \"asd\",\n                headComponent: null\n            });\n\n            this.setState({\n                headComponent: <Head\n                    auth={false}\n                    load={true}\n                />\n            })\n        }\n\n        this.centrifuge = new Centrifuge(CONFIG.url);\n        this.centrifuge.setToken(\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE2MjYwMzI0MzEsImV4cCI6MTc4Mzc5ODgzMSwiYXVkIjoid3d3LmV4YW1wbGUuY29tIiwic3ViIjoianJvY2tldEBleGFtcGxlLmNvbSIsIkdpdmVuTmFtZSI6IkpvaG5ueSIsIlN1cm5hbWUiOiJSb2NrZXQiLCJFbWFpbCI6Impyb2NrZXRAZXhhbXBsZS5jb20iLCJSb2xlIjpbIk1hbmFnZXIiLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.meN08YC99TeOJZWLbMKCwxhtOA_s3RaZ1QH-YARC6CM\");\n\n        this.centrifuge.on('connect', function() {\n            console.log(\"[ centrifuge connected ]\")\n        });\n        this.centrifuge.on('disconnect', function(){\n            console.log(\"[ centrifuge disconnected ]\")\n        });\n        this.centrifuge.connect();\n\n\n        this.centrifuge.subscribe(\"public\", function(message) {\n            console.log(message);\n        });\n\n        if (!window.Notification || !Notification.requestPermission){\n            console.log('...')\n        }else{\n            Notification.requestPermission(function(permission){\n                // console.log('Результат запроса прав:', permission);\n            });\n        }\n\n        cent = this.centrifuge\n    }\n\n    routes = mount({\n        '/': route({\n            title: 'DevCodeMyLife - Добро пожаловать',\n            head: <>\n                <meta name=\"description\" content=\"Социальная сеть для разработчиков\" />\n                <script>\n                    console.log('[ app start ]')\n                </script>\n            </>,\n            view: <Main />\n        }),\n        '/messages': route({\n            title: 'Мессенджер',\n            head: <>\n                <meta name=\"description\" content=\"Мессенджер\" />\n                <script>\n                    console.log('[ app start ]')\n                </script>\n            </>,\n            view: <Messages auth={auth} cent={cent} user={user} />\n        }),\n        '/user': route({\n            title: 'DevCodeMyLife',\n            head: <>\n                <meta name=\"description\" content=\"\" />\n                <script>\n                    console.log('[ app start ]')\n                </script>\n            </>,\n            view: <MainUser />\n        }),\n        '/feeds': route({\n            title: 'Новости',\n            head: <>\n                <meta name=\"description\" content=\"Новости, у нас есть все, чего нет напиши сам.\" />\n                <script>\n                    console.log('[ app start ]')\n                </script>\n            </>,\n            view: <Feed/>\n        }),\n        '/post': route({\n            title: 'DevCodeMyLife',\n            head: <>\n                <meta name=\"description\" content=\"\" />\n                <script>\n                    console.log('[ app start ]')\n                </script>\n            </>,\n            view: <FeedOnePage/>\n        }),\n        '/about': route({\n            title: 'DevCodeMyLife',\n            head: <>\n                <meta name=\"description\" content=\"\" />\n                <script>\n                    console.log('[ app start ]')\n                </script>\n            </>,\n            view: <About/>\n        })\n    })\n\n    render(){\n        if (this.state.load){\n            if (this.state.auth){\n                return (\n                    <HelmetProvider>\n                        <div className=\"wrapper\">\n                            {\n                                this.state.headComponent\n\n                            }\n                            <BrowserRouter>\n                                <Switch>\n                                    <Route path=\"/\" render={({history, match}) =>\n                                        <Router\n                                            routes={this.routes}\n                                            history={history}\n                                            basename={match.url}\n                                        >\n                                            <Suspense fallback={null}>\n                                                <View/>\n                                            </Suspense>\n                                        </Router>\n                                    } />\n                                </Switch>\n                            </BrowserRouter>\n                            <div className=\"footer\">\n                                © {new Date().getFullYear()} DevCodeMyLife\n                            </div>\n                        </div>\n                    </HelmetProvider>\n                );\n            }else{\n                return (\n                    <div>\n                        <Head auth={false} load={true} />\n                        <Main />\n                    </div>\n                );\n            }\n        }else{\n            return (\n                <div style={{\n                    position: \"fixed\",\n                    width: \"100%\",\n                    height: \"100%\",\n                    display: \"flex\",\n                    justifyContent: \"center\",\n                    alignItems: \"center\"\n                }}>\n                    <div className=\"loader\" />\n                </div>\n            )\n        }\n\n    }\n}\n\nReactDOM.render(\n    React.createElement(App, null),\n    document.getElementById('root')\n)"]},"metadata":{},"sourceType":"module"}